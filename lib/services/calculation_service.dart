

/// –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º—ã –≤–æ–¥—ã
class CalculationService {
  static Stream<int>? _activityStream;

  /// –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–Ω–µ–≤–Ω—É—é –Ω–æ—Ä–º—É –≤–æ–¥—ã (–º–ª)
  /// –§–æ—Ä–º—É–ª–∞: (–≤–µ—Å * 30 –º–ª) + –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (0-500 –º–ª) + –ø–æ–≥–æ–¥–∞ (0-500 –º–ª –ø—Ä–∏ 30¬∞C+)
  static int calculateDailyNorm({
    required int weight,
    required int activityLevel, // 0 - –Ω–∏–∑–∫–∏–π, 1 - —Å—Ä–µ–¥–Ω–∏–π, 2 - –≤—ã—Å–æ–∫–∏–π
    int weatherAddition = 0, // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—ä—ë–º –∏–∑-–∑–∞ –ø–æ–≥–æ–¥—ã
  }) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if (weight < 30 || weight > 200) {
      throw ArgumentError('–í–µ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 30-200 –∫–≥');
    }
    if (activityLevel < 0 || activityLevel > 2) {
      throw ArgumentError('activityLevel –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0, 1 –∏–ª–∏ 2');
    }
    if (weatherAddition < 0) {
      throw ArgumentError('weatherAddition –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º');
    }
    // –†–∞—Å—á—ë—Ç –ø–æ —Ñ–æ—Ä–º—É–ª–µ
    int activityML = [0, 250, 500][activityLevel];
    return (weight * 30) + activityML + weatherAddition;
  }

  /// –ü–æ—Ç–æ–∫ —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –≤–æ–¥—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  /// –û–¢–ö–õ–Æ–ß–ï–ù - –±–∞–∑–æ–≤–∞—è –Ω–æ—Ä–º–∞ —É–∂–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  static Stream<int> get activityBasedAddition {
    // üö´ –û—Ç–∫–ª—é—á–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ–±–∞–≤–∫–∏ –æ—Ç –∞–∫—Å–µ–ª–µ—Ä–æ–º–µ—Ç—Ä–∞
    // –ù–æ—Ä–º–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø–æ –≤–µ—Å—É + –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —É—Ä–æ–≤–Ω—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    _activityStream ??= Stream<int>.periodic(
      const Duration(hours: 24), // –†–∞–∑ –≤ —Å—É—Ç–∫–∏
      (_) => 0, // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 0 (–±–µ–∑ –¥–æ–±–∞–≤–æ–∫)
    ).asBroadcastStream();
    return _activityStream!;
  }
} 